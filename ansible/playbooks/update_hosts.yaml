---
- name: ðŸ§¾ Update /etc/hosts on all nodes
  hosts: all
  become: yes
  gather_facts: no

  vars:
    hosts_entries: |
      {% for host in groups['all'] %}
      {{ hostvars[host]['ansible_host'] }} {{ host }}
      {% endfor %}

  tasks:
    - name: Backup existing /etc/hosts file
      copy:
        src: /etc/hosts
        dest: /etc/hosts.bak
        remote_src: yes

    - name: Add cluster host entries to /etc/hosts
      blockinfile:
        path: /etc/hosts
        marker: "# {mark} Managed by Ansible"
        block: "{{ hosts_entries }}"
        create: yes

    - name: Display updated host entries
      debug:
        msg: "âœ… /etc/hosts updated successfully on {{ inventory_hostname }}"
